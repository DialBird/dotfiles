---
name: tasking
description: フェーズ3でタスクを分解する
---

<!--
このファイルはSDD Phase 3 (Tasks) を遂行するためのプロンプトテンプレートであり、Specify/Plan成果と制約を入力として、FP/DDD整合のタスク分解と実行順序を出力する。出力はドメイン層・アプリ層・インフラ層の区分、依存関係、WIP管理方針、Done/Ready定義を含み、以後のImplementフェーズが迷わずTDDサイクルに入れる粒度であることが制約。
-->

## 実行原則

- Specifyのユビキタス言語とPlanのアーキ方針をそのままタスク命名に反映し、境界づけられたコンテキストを跨がない
- ドメインサービス→アプリケーションサービス→インフラの流れで責務を分割し、FPスタイルのデータパイプを単一責務タスクへ落とし込む
- 1タスク = 1つのレビュー/テスト可能な成果物とし、優先度・独立性・テスト容易性を明示する
- スキーマ/マイグレーション、リポジトリ、API契約、型生成、UI/クライアント、セキュリティ/監査などの観点で漏れをチェックする
- 各タスクは「入力・期待出力・検証手段・依存・DoD」を最低限持ち、TDDで即テスト記述が可能な具体度にする
- タスク進捗はMarkdownチェックボックス（`- [ ]`/`- [x]`）とステータスタグで可視化し、フェーズ内でのWIP管理と合意形成に活用する
- 生成物は `specs/[feature-number]-[feature-name]/` 配下に保存するファイル名を推奨し、Implementフェーズの参照ポイントを整える
- Implementコマンドで指定できるよう、タスクID・内容・完成条件を明示し、タスクごとの入力/出力/テストを記述する
- 依存とリスクを可視化し、WIP上限と優先順位を設定してフェーズ全体のフロー効率を最大化する
- 次フェーズに進む前にユーザーへ確認を求める（「確認不要」の指示が無ければ自動遷移しない）

## 出力テンプレート

```markdown
# Tasks

## 0. メタ情報
- 推奨保存先: `specs/<feature-number>-<feature-name>/tasks.md`
- 参照したPlan/Specifyファイル:
- 作成日と作成者:

## 1. 入力とスコープ確認
- 参照仕様/Plan:
- ゴールと非ゴール:
- 既知の制約・ブロック:

## 2. タスク方針
- WIP上限:
- Ready定義:
- Done定義:
- コーディング規約/テスト指針の補足:

## 3. タスク分解一覧（優先度・独立性・テスト容易性込み）
- 例: 1. [DB] DrizzleスキーマにXを追加しマイグレーション生成
- 例: 2. [Repo] PatientRepositoryにYクエリを追加（PHI/監査対応）

| タスクID | カテゴリ (例:[DB]/[Repo]/[API]/[Gen]/[UI]/[Sec]) | レイヤ (Domain/App/Infra) | 優先度 | 概要 | 入力 | 期待される成果物/出力 | テスト/検証手段 | 依存 |
|----------|-------------------------------------------------|---------------------------|--------|------|------|------------------------|-----------------|------|
| T-001    |                                                 |                           |        |      |      |                        |                 |      |

### タスク進捗チェックリスト運用
- [ ] T-001: <概要>（担当: / ステータス: Ready｜WIP｜Blocked｜Review｜Done予定日: ）
- [ ] T-002: <概要>（担当: / ステータス: Ready｜WIP｜Blocked｜Review｜Done予定日: ）
- [x] T-000: <サンプル完了タスク>（担当: / 完了日: ）

#### 運用ルール
- 新規タスクを追加したら、チェックリストにも`- [ ] T-xxx: ...`形式で追記する
- 着手時はステータスを`WIP`に更新し、ブロック発生時は`Blocked`と原因/対応予定を末尾に併記する
- タスク完了でDoD充足したら`- [x]`へ切り替え、完了日やリンク（PR/証跡）を追記して関係者への共有を容易にする
- Implementコマンドを発行したタスクは、チェックリスト右端へ進捗メモ（例:`PR #123 ready for review`）を添えてトレーサビリティを確保する

## 4. タスク別DoD (Definition of Done)
- T-001: 例) 「DBマイグレーションがCI/ローカルで適用でき、後方互換である」

## 5. 分解観点チェック
- [ ] スキーマ変更 / マイグレーション
- [ ] リポジトリ実装 / テスト
- [ ] API契約 / エンドポイント実装
- [ ] 型生成 / 変換レイヤ
- [ ] UI / クライアント
- [ ] セキュリティ / 監査 / ロール

## 6. Implementコマンドガイド
- 実行フォーマット例: `/implement T-001 --summary "<タスク内容>" --target "<編集対象ファイル/モジュール>" --definition-of-done "<完成条件>"`
- 各タスクごとのコマンドテンプレート:
  - T-001:
  - T-002:

## 7. 実行シーケンス
- フェーズ/スプリント区分:
- 並列実行グループ:
- クリティカルパス:

## 8. テストと検証
- 各タスクのテスト責任 (describe単位):
- 自動化/ツール:
- スパイク or 検証項目:

## 9. リスク・ブロッカー・未決事項
- リスク/影響/回避策:
- 外部依存や承認待ち:
- Phase 4移行前に解消すべき点:

## 10. ハンドオフとナレッジ
- ドキュメント/ADR更新対象:
- チーム間ハンドオフ:
- Phase 5 Knowledgeへの入力:

## 11. 次フェーズ進行確認
- Implementへ進む条件:
- ユーザー確認依頼メッセージ案:
```
