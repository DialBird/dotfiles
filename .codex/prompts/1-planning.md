---
name: planning
description: 技術計画を立てる
---

<!--
このファイルはSDD Phase 2 (Plan) を遂行するためのプロンプトテンプレートであり、Specify成果を入力としてFP/DDD整合の技術計画を出力する。入力には仕様、制約、既存アーキ情報を想定し、出力はアーキ案・トレードオフ・技術リスク・タスク分解指針を含む。Planの成果はPhase 3 TasksとTDD実装が迷わない粒度であることが制約。
-->

!!!次フェーズに進む前にユーザーへ確認を求める（「確認不要」指定が無い限り自動遷移しない）!!!

## 実行原則

- Specifyで定義したユビキタス言語と境界づけられたコンテキストを基準に、責務分割とデータフローをFPスタイルで可視化する
- 最低2案（推奨3案）のBest-of-Nアーキテクチャ案を提示し、品質属性とコストの観点で比較評価して最適案を選出する
- 技術的選択肢を複数提示し、品質属性（性能、可観測性、セキュリティ等）のトレードオフを定量・定性で比較する
- ドメインサービス/アプリケーションサービス/インフラの役割を分離し、依存方向と契約（ports/adapters等）を明示する
- リスクと検証計画を列挙し、次フェーズで消化するスパイクやタスクの優先順位を付与する
- 生成物は `specs/[feature-number]-[feature-name]/` 配下に保存するファイル名を推奨し、`docs/architecture-specification.md` の更新対象を明確にする

## 出力テンプレート

```markdown
# Plan

## 0. メタ情報
- 推奨保存先: `specs/<feature-number>-<feature-name>/plan-<candidate-id>.md`
- 参照した仕様ファイル:
- 影響する既存ドキュメント (特に `docs/architecture-specification.md`):

## 1. 入力の要約
- 参照した仕様 (リンク可):
- 成功指標との整合性:
- スコープ外事項:

## 2. アーキテクチャ方針候補 (Best-of-N)
### 候補A
- 方針概要:
- 主なコンポーネント/責務分担:
- 品質メリット:
- 想定リスクと対策:
- 推奨保存ファイル例: `specs/<feature-number>-<feature-name>/plan-A.md`
### 候補B
- 方針概要:
- 主なコンポーネント/責務分担:
- 品質メリット:
- 想定リスクと対策:
- 推奨保存ファイル例: `specs/<feature-number>-<feature-name>/plan-B.md`
### （必要なら候補C以降を追加）

## 3. 候補比較と最終選定
- 評価指標 (性能/可観測性/セキュリティ/コスト等):
- ベスト候補:
- 選定理由:
- 非採用候補のフォロー:

## 4. アーキテクチャ方針（採用案）
- コンテキスト境界と責務:
- データフロー (FPパイプライン/メッセージ):
- インターフェース契約 (ports/adapters or API):
- 技術選択肢と決定理由:

## 5. 品質属性とトレードオフ
| 属性 | 目標 | 施策 | トレードオフ |
|------|------|------|--------------|
|      |      |      |              |

## 6. リスクと検証
- 技術的リスク:
- 不確実性削減プラン (スパイク/PoC):
- 観測とガードレール (アラート/メトリクス):

## 7. 依存関係と整合
- 他チーム/システム依存:
- データ契約・バージョン管理方針:
- 過去資産/既存実装の再利用ポイント:

## 8. タスク分解ガイド
- ドメイン層:
- アプリケーション層:
- インフラ/ツール:
- 並列実行可否と優先度:

## 9. ドキュメント更新計画
- `docs/architecture-specification.md` の更新内容:
- その他のdocs/やRunbook:
- ADR作成/更新予定:

## 10. 決定事項とフォローアップ
- 重要なArchitecture Decision:
- 未決/フォローアップ項目:
- Knowledge更新先 (ADR/Runbook 等):

## 11. 次フェーズ進行確認
- Tasksへ進む条件:
- ユーザー確認依頼メッセージ案:
```
