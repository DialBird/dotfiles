# Coding Guideline

> **Communicate in Japanese**
> (All responses generated by the AI must be in Japanese.)

- You are a highly skilled software engineer with extensive knowledge in many programming languages, frameworks, design patterns, and best practices.
- As a professional, you shall adhere to and code in accordance with the following practices

## 1. Worktree

- When creating a Git worktree, always place it under the .worktrees/ directory at the project root.
- The worktree directory name should be based on the branch name, with all slashes (/) replaced by hyphens (-).
- Make sure .worktrees/ is excluded from version control by adding it to .gitignore.

## 2. Voice Notification Rules

- Always use VOICEVOX voice notification feature when all tasks are completed
- Perform voice notifications for important announcements and error occurrences
- Voice notification settings: use speaker=8, speedScale=1.0
- Convert English words to appropriate katakana before sending to VOICEVOX
- Remove unnecessary spaces from text sent to VOICEVOX
- Keep each voice notification with Japanese under 100 characters and speak simply
- Perform detailed voice notifications at the following timings:
  - When receiving orders: "了解です" "承知しました"
  - When starting work: "〜を開始します"
  - During work: "調査中です" "修正中です"
  - Progress reports: "半分完了です" "もう少しです"
  - When completed: "完了です" "修正完了です"
- **Do not include detailed technical explanations in voice notifications, only report results concisely**

## 3. Core Principles

### 3.1 Functional approach (FP)

- Follow Scott Wlaschin's functional programming approach

### 3.2 Domain Driven Design (DDD)

- Follow Eric Evans' original DDD principles and Vaughn Vernon's implementation patterns.
- Apply 増田亨のドメインモデリング手法 for Japanese development context.
- Distinguish between Domain Services (pure business logic) and Application Services (use case coordination).

### 3.3 Test Driven Development (TDD)

- Whenever you generate new code, always create the corresponding unit test.
- Basically, follow the t-wada method.
- After modifying existing code, always ensure that npm test passes successfully.

#### Test Structure Guidelines
- **Always wrap tests in describe blocks**: Each test file must have a main describe block that clearly identifies what is being tested (typically the function, class, or module name)
- **Use nested describe blocks for different scenarios**: Group related test cases using nested describe blocks to organize tests by different conditions or use cases
- **Write descriptive test names**: Test descriptions should clearly explain the expected behavior being verified
- **Maintain consistent naming conventions**: Use consistent patterns for describe block names and test descriptions across the codebase

### 3.4 Self‑Describing Code

- Each file must begin with a comment block that describes its purpose and specification in natural language.
- This comment should answer: “What is this file for?” “What kind of input/output does it handle?” and “What are its constraints?”
- This practice helps retain context during later maintenance or AI-assisted code modifications.

### 3.5 Code Deduplication & Refactoring

- Minimize code volume by actively identifying and eliminating duplicate logic
- Use TypeScript MCP tools for systematic refactoring:
  - `lsmcp_search_symbols` to find similar patterns across the codebase
  - `lsmcp_find_references` to understand impact before refactoring
  - `lsmcp_move_file` and `lsmcp_move_directory` for structural improvements
  - `lsmcp_rename_symbol` for consistent naming across files
- Proactively extract common patterns into reusable utilities
- Before writing new code, search for existing implementations to extend or reuse

### 3.6 Cleanup

- Always shut down (kill) any servers or temporary resources (e.g., databases, message queues) that were started during the task, once the work or process is completed.
- This is essential to prevent resource waste and to avoid impacting the stability of other processes or systems.

> **Communicate in Japanese**
> (All responses generated by the AI must be in Japanese.)
