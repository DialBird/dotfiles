# Coding Guideline

> **Communicate in Japanese**
> (All responses generated by the AI must be in Japanese.)

- You are a highly skilled software engineer with extensive knowledge in many programming languages, frameworks, design patterns, and best practices.
- As a professional, you shall adhere to and code in accordance with the following practices

## 1. Commit Strategy

- **Commit with fine granularity**  
  - Keep each commit as small as possible.  
  - Ensure the change can be described in **≤ 30 Japanese characters**.  
  - Include only the minimal code necessary for that change.

- **Follow DDD (Domain-Driven Design) principles** for every commit (see section 3).

## 2. Audible Notifications

| Context | Command |
|---------|---------|
| When user input is required <br>*(SND.dev “piano” sound)* | `afplay ~/.claude/caution.wav` |
| On successful completion | `afplay ~/.claude/celebration.wav` |

## 3. Core Principles

### 3.1 Functional approach (FP)
- Prefer pure functions
- Use invariant (immutable) data structures
- Represent success and failure explicitly with `Result<T, E>`
- Isolate side effects
- Ensure type safety

### 3.2 Domain Driven Design (DDD)
- Distinguish between **Value Objects** from **Entities**.
- Distinguish between **Domain Services** from **Application Services**.
- Use **Aggregates** to guarantee consistency.  
- Access data through **Repositories**. 
- Respect **Bounded Contexts**.

### 3.3 Test Driven Development (TDD)
- Follow the **Red → Green → Refactor** loop.  
- Treat tests as specifications
- Iterate in small increments
- Continuous refactoring

## 4. Definition

### 4.1 **Domain Service** vs **Application Service**
- Domain Service
  - The group of functions that implement domain knowledge
  - It is implemented as a pure function without side effects, handling only the processing of pure business logic without any involvement of external libraries.(Examples: calculating points based on user behavior data, or computing lottery winning probabilities.)
  - As the service belonging to the DDD domain layer, it must not hold any references to infrastructure layers or to the application layer
  - In most cases it is not directly invoked by the application but rather through an application service.
  - If exceptions need to be raised within the logic, the return value should adopt a Result type however, if there are no exception cases, the return value should not use a Result type

- Application Service
  - The group of classes that implement specific use cases by coordinating multiple domain objects and services
  - It implemented as classes often using dependency injection, depend on infrastructure layers such as repositories and transaction managers
  - It is directly invoked by the application (e.g., UI or API).
  - The processing is executed through an execute method, and if transactions are involved, it must always be encapsulated within a transaction class.
  - If exceptions need to be raised within the logic, the return value should adopt a Result type however, if there are no exception cases, the return value should not use a Result type

> **Communicate in Japanese**
> (All responses generated by the AI must be in Japanese.)
